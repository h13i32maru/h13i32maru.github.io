<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/validation/validation-rules.js | Aurelia:Validation API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
</head>
<body class="layout-container">

<header>
  <a href="./">Home</a>
  <a href="identifiers.html">Identifier</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <a data-ice="repoURL" href="https://github.com/aurelia/validation" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div data-ice="classWrap">
  <h2>Class</h2>
  <ul>
    
  <li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~AlphaNumericOrWhitespaceValidationRule.html">AlphaNumericOrWhitespaceValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~AlphaNumericValidationRule.html">AlphaNumericValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~AlphaOrWhitespaceValidationRule.html">AlphaOrWhitespaceValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~AlphaValidationRule.html">AlphaValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~BetweenLengthValidationRule.html">BetweenLengthValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~BetweenValueValidationRule.html">BetweenValueValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~ContainsOnlyValidationRule.html">ContainsOnlyValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~CustomFunctionValidationRule.html">CustomFunctionValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/debouncer.js~Debouncer.html">Debouncer</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~DigitValidationRule.html">DigitValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~EmailValidationRule.html">EmailValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~EqualityValidationRule.html">EqualityValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~EqualityValidationRuleBase.html">EqualityValidationRuleBase</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~EqualityWithOtherLabelValidationRule.html">EqualityWithOtherLabelValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~InCollectionValidationRule.html">InCollectionValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~InEqualityValidationRule.html">InEqualityValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~InEqualityWithOtherLabelValidationRule.html">InEqualityWithOtherLabelValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~MaximumInclusiveValueValidationRule.html">MaximumInclusiveValueValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~MaximumLengthValidationRule.html">MaximumLengthValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~MaximumValueValidationRule.html">MaximumValueValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~MediumPasswordValidationRule.html">MediumPasswordValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~MinimumInclusiveValueValidationRule.html">MinimumInclusiveValueValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~MinimumLengthValidationRule.html">MinimumLengthValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~MinimumValueValidationRule.html">MinimumValueValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~NumericValidationRule.html">NumericValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/path-observer.js~PathObserver.html">PathObserver</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~RegexValidationRule.html">RegexValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~StrongPasswordValidationRule.html">StrongPasswordValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules-collection.js~SwitchCaseValidationRulesCollection.html">SwitchCaseValidationRulesCollection</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validate-custom-attribute-view-strategy.js~TWBootstrapViewStrategy.html">TWBootstrapViewStrategy</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/utilities.js~Utilities.html">Utilities</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validate-custom-attribute-view-strategy.js~ValidateCustomAttributeViewStrategy.html">ValidateCustomAttributeViewStrategy</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validate-custom-attribute-view-strategy.js~ValidateCustomAttributeViewStrategyBase.html">ValidateCustomAttributeViewStrategyBase</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-config.js~ValidationConfig.html">ValidationConfig</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-config.js~ValidationConfigDefaults.html">ValidationConfigDefaults</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-group.js~ValidationGroup.html">ValidationGroup</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-group-builder.js~ValidationGroupBuilder.html">ValidationGroupBuilder</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-locale.js~ValidationLocale.html">ValidationLocale</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-property.js~ValidationProperty.html">ValidationProperty</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-result.js~ValidationResult.html">ValidationResult</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-result.js~ValidationResultProperty.html">ValidationResultProperty</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules.js~ValidationRule.html">ValidationRule</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/validation/validation-rules-collection.js~ValidationRulesCollection.html">ValidationRulesCollection</a></span></li>
</ul>
</div>



<div data-ice="functionWrap">
  <h2><a href="function/">Function</a></h2>
  <ul>
    
  <li data-ice="functionDoc"><span><a href="function/index.html#static-function-configure">configure</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-ensure">ensure</a></span></li>
</ul>
</div>

<div data-ice="variableWrap">
  <h2><a href="variable/">Variable</a></h2>
  <ul>
    
  <li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-data">data</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-data">data</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-data">data</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-data">data</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-data">data</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-data">data</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-data">data</a></span></li>
<li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-data">data</a></span></li>
</ul>
</div>




</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/validation/validation-rules.js</h1>
<pre class="source-code line-number"><code class="prettyprint linenums" data-ice="content">import {Utilities} from &apos;../validation/utilities&apos;;
import {ValidationLocale} from &apos;../validation/validation-locale&apos;;

export class ValidationRule {
  constructor(threshold, onValidate, message) {
    this.onValidate = onValidate;
    this.threshold = threshold;
    this.message = message;
    this.errorMessage = null;
    this.ruleName = this.constructor.name;
  }

  withMessage(message) {
    this.message = message;
  }

  explain() {
    return this.errorMessage;
  }

  setResult(result, currentValue, locale) {
    if (result === true || result === undefined || result === null || result === &apos;&apos; ) {
      this.errorMessage = null;
      return true;
    }
    else {
      if (typeof(result) === &apos;string&apos;) {
        this.errorMessage = result;
      }
      else {
        if (this.message) {
          if (typeof(this.message) === &apos;function&apos;) {
            this.errorMessage = this.message(currentValue, this.threshold);
          }
          else if (typeof(this.message) === &apos;string&apos;) {
            this.errorMessage = this.message;
          }
          else
            throw &apos;Unable to handle the error message:&apos; + this.message;
        }
        else {
          this.errorMessage = locale.translate(this.ruleName, currentValue, this.threshold);
        }
      }
      return false;
    }
  }

  /**
   * Validation rules: return a promise that fulfills and resolves to true/false
   */
  validate(currentValue, locale) {
    if(locale === undefined)
    {
      locale = ValidationLocale.Repository.default;
    }

    currentValue = Utilities.getValue(currentValue);
    var result = this.onValidate(currentValue, this.threshold, locale);
    var promise = Promise.resolve(result);

    var nextPromise = promise.then(
      (promiseResult) =&gt; {
        return this.setResult(promiseResult, currentValue, locale);
      },
      (promiseFailure) =&gt; {
        if( typeof(promiseFailure) === &apos;string&apos; &amp;&amp; promiseFailure !== &apos;&apos;)
          return this.setResult(promiseFailure, currentValue, locale);
        else
          return this.setResult(false, currentValue, locale);
      }
    );
    return nextPromise;
  }
}

export class EmailValidationRule extends ValidationRule {
  //https://github.com/chriso/validator.js/blob/master/LICENSE
  constructor() {
    super(
      null,
      (newValue, threshold) =&gt; {
        if (/\s/.test(newValue)) {
          return false;
        }
        var parts = newValue.split(&apos;@&apos;);
        var domain = parts.pop();
        var user = parts.join(&apos;@&apos;);

        if (!this.isFQDN(domain)) {
          return false;
        }
        return this.emailUserUtf8Regex.test(user);
      }
    );  
    this.emailUserUtf8Regex = /^((([a-z]|\d|[!#\$%&amp;&apos;\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&amp;&apos;\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))$/i;
    this.isFQDN = function (str) {
      var parts = str.split(&apos;.&apos;);
      for (var part, i = 0; i &lt; parts.length; i++) {
        part = parts[i];
        if (part.indexOf(&apos;__&apos;) &gt;= 0) {
          return false;
        }
        part = part.replace(/_/g, &apos;&apos;);
        if (!/^[a-z\u00a1-\uffff0-9-]+$/i.test(part)) {
          return false;
        }
        if (part[0] === &apos;-&apos; || part[part.length - 1] === &apos;-&apos; ||
          part.indexOf(&apos;---&apos;) &gt;= 0) {
          return false;
        }
      }
      return true;
    };
  }
}

export class MinimumLengthValidationRule extends ValidationRule {
  constructor(minimumLength) {
    super(
      minimumLength,
      (newValue, minimumLength) =&gt; {
        return newValue.length !== undefined &amp;&amp; newValue.length &gt;= minimumLength;
      }
    );
  }
}

export class MaximumLengthValidationRule extends ValidationRule {
  constructor(maximumLength) {
    super(
      maximumLength,
      (newValue, maximumLength) =&gt; {
        return newValue.length !== undefined &amp;&amp; newValue.length &lt;= maximumLength;
      }
    );
  }
}

export class BetweenLengthValidationRule extends ValidationRule {
  constructor(minimumLength, maximumLength) {
    super(
      {minimumLength: minimumLength, maximumLength: maximumLength},
      (newValue, threshold) =&gt; {
        return newValue.length !== undefined
          &amp;&amp; newValue.length &gt;= threshold.minimumLength
          &amp;&amp; newValue.length &lt;= threshold.maximumLength;
      }
    );
  }
}

export class CustomFunctionValidationRule extends ValidationRule {
  constructor(customFunction, threshold) {
    super(
      threshold,
      customFunction
    )
  }
}

export class NumericValidationRule extends ValidationRule {
  constructor() {
    super(
      null,
      (newValue, threshold, locale) =&gt; {
        var numericRegex = locale.setting(&apos;numericRegex&apos;);
        var floatValue = parseFloat(newValue);
        return !Number.isNaN(parseFloat(floatValue))
          &amp;&amp; Number.isFinite(floatValue)
          &amp;&amp; numericRegex.test(newValue);
      }
    );
  }
}

export class RegexValidationRule extends ValidationRule {
  constructor(regex) {
    super(
      regex,
      (newValue, regex) =&gt; {
        return regex.test(newValue);
      }
    );
  }
}

export class ContainsOnlyValidationRule extends RegexValidationRule{
  constructor(regex){
    super(regex);
  }
}

export class MinimumValueValidationRule extends ValidationRule {
  constructor(minimumValue) {
    super(
      minimumValue,
      (newValue, minimumValue) =&gt; {
        return Utilities.getValue(minimumValue) &lt; newValue;
      }
    );
  }
}

export class MinimumInclusiveValueValidationRule extends ValidationRule {
  constructor(minimumValue) {
    super(
      minimumValue,
      (newValue, minimumValue) =&gt; {
        return Utilities.getValue(minimumValue) &lt;= newValue;
      }
    );
  }
}

export class MaximumValueValidationRule extends ValidationRule {
  constructor(maximumValue) {
    super(
      maximumValue,
      (newValue, maximumValue) =&gt; {
        return newValue &lt; Utilities.getValue(maximumValue);
      }
    );
  }
}

export class MaximumInclusiveValueValidationRule extends ValidationRule{
  constructor(maximumValue) {
    super(
      maximumValue,
      (newValue, maximumValue) =&gt; {
        return newValue &lt;= Utilities.getValue(maximumValue);
      }
    );
  }
}

export class BetweenValueValidationRule extends ValidationRule {
  constructor(minimumValue, maximumValue) {
    super(
      {minimumValue: minimumValue, maximumValue: maximumValue},
      (newValue, threshold) =&gt; {
        return Utilities.getValue(threshold.minimumValue) &lt;= newValue &amp;&amp; newValue &lt;= Utilities.getValue(threshold.maximumValue);
      }
    );
  }
}

export class DigitValidationRule extends ValidationRule {
  constructor() {
    super(
      null,
      (newValue, threshold) =&gt; {
        return this.digitRegex.test(newValue);
      }
    );
    this.digitRegex = /^\d+$/;
  }
}

export class AlphaNumericValidationRule extends ValidationRule {
  constructor() {
    super(
      null,
      (newValue, threshold) =&gt; {
        return this.alphaNumericRegex.test(newValue);
      }
    );
    this.alphaNumericRegex = /^[a-z0-9]+$/i;
  }
}

export class AlphaValidationRule extends ValidationRule {
  constructor() {
    super(
      null,
      (newValue, threshold) =&gt; {
        return this.alphaRegex.test(newValue);
      }
    );
    this.alphaRegex = /^[a-z]+$/i;
  }
}


export class AlphaOrWhitespaceValidationRule extends ValidationRule{
  constructor() {
    super(
      null,
      (newValue, threshold) =&gt; {
        return this.alphaNumericRegex.test(newValue);
      }
    );
    this.alphaNumericRegex = /^[a-z\s]+$/i;
  }
}


export class AlphaNumericOrWhitespaceValidationRule extends ValidationRule {
  constructor() {
    super(
      null,
      (newValue, threshold) =&gt; {
        return this.alphaNumericRegex.test(newValue);
      }
    );
    this.alphaNumericRegex = /^[a-z0-9\s]+$/i;
  }
}

export class MediumPasswordValidationRule extends ValidationRule {
  constructor(minimumComplexityLevel) {
    super(
      (minimumComplexityLevel) ? minimumComplexityLevel : 3,
      (newValue, threshold) =&gt; {
        if (typeof (newValue) !== &apos;string&apos;)
          return false;
        var strength = 0;

        strength += /[A-Z]+/.test(newValue) ? 1 : 0;
        strength += /[a-z]+/.test(newValue) ? 1 : 0;
        strength += /[0-9]+/.test(newValue) ? 1 : 0;
        strength += /[\W]+/.test(newValue) ? 1 : 0;
        return strength &gt;= threshold;
      }
    );
  }
}


export class StrongPasswordValidationRule extends MediumPasswordValidationRule
{
  constructor(){
    super(4);
  }
}

export class EqualityValidationRuleBase extends ValidationRule {
  constructor(otherValue, equality, otherValueLabel) {
    super(
      {
        otherValue: otherValue,
        equality: equality,
        otherValueLabel: otherValueLabel
      },
      (newValue, threshold) =&gt; {
        var otherValue = Utilities.getValue(threshold.otherValue);
        if (newValue instanceof Date &amp;&amp; otherValue instanceof Date)
          return threshold.equality === (newValue.getTime() === otherValue.getTime());
        return threshold.equality === (newValue === otherValue);
      }
    );
  }
}

export class EqualityValidationRule extends EqualityValidationRuleBase{
  constructor(otherValue){
    super(otherValue, true);
  }
}

export class EqualityWithOtherLabelValidationRule extends EqualityValidationRuleBase{
  constructor(otherValue, otherLabel){
    super(otherValue, true, otherLabel);
  }
}

export class InEqualityValidationRule extends EqualityValidationRuleBase{
  constructor(otherValue){
    super(otherValue, false);
  }
}

export class InEqualityWithOtherLabelValidationRule extends EqualityValidationRuleBase{
  constructor(otherValue, otherLabel){
    super(otherValue, false, otherLabel);
  }
}


export class InCollectionValidationRule extends ValidationRule {
  constructor(collection) {
    super(
      collection,
      (newValue, threshold) =&gt; {
        var collection = Utilities.getValue(threshold);
        for (let i = 0; i &lt; collection.length; i++) {
          if (newValue === collection[i])
            return true;
        }
        return false;
      }
    );
  }
}
</code></pre>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.0.2)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
</body>
</html>
