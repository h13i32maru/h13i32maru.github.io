<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/Publisher/Builder/ClassDocBuilder.js | ESDoc API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
</head>
<body class="layout-container">

<header>
  <a href="./">Home</a>
  <a href="identifiers.html">Identifier</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <a data-ice="repoURL" href="https://github.com/h13i32maru/esdoc" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div data-ice="classWrap">
  <h2>Class</h2>
  <ul>
    
  <li data-ice="classDoc"><span><a href="class/src/Publisher/Builder/ASTDocBuilder.js~ASTDocBuilder.html">ASTDocBuilder</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Util/ASTUtil.js~ASTUtil.html">ASTUtil</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Doc/AbstractDoc.js~AbstractDoc.html">AbstractDoc</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Doc/AssignmentDoc.js~AssignmentDoc.html">AssignmentDoc</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Doc/ClassDoc.js~ClassDoc.html">ClassDoc</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Publisher/Builder/ClassDocBuilder.js~ClassDocBuilder.html">ClassDocBuilder</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Parser/CommentParser.js~CommentParser.html">CommentParser</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Publisher/Builder/CoverageBuilder.js~CoverageBuilder.html">CoverageBuilder</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Publisher/Builder/DocBuilder.js~DocBuilder.html">DocBuilder</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Factory/DocFactory.js~DocFactory.html">DocFactory</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Publisher/Builder/DocResolver.js~DocResolver.html">DocResolver</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/ESDoc.js~ESDoc.html">ESDoc</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/ESDocCLI.js~ESDocCLI.html">ESDocCLI</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Parser/ESParser.js~ESParser.html">ESParser</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Doc/ExternalDoc.js~ExternalDoc.html">ExternalDoc</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Doc/FileDoc.js~FileDoc.html">FileDoc</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Publisher/Builder/FileDocBuilder.js~FileDocBuilder.html">FileDocBuilder</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Doc/FunctionDoc.js~FunctionDoc.html">FunctionDoc</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Publisher/Builder/IdentifiersDocBuilder.js~IdentifiersDocBuilder.html">IdentifiersDocBuilder</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Publisher/Builder/IndexDocBuilder.js~IndexDocBuilder.html">IndexDocBuilder</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Util/InvalidCodeLogger.js~InvalidCodeLogger.html">InvalidCodeLogger</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Doc/MemberDoc.js~MemberDoc.html">MemberDoc</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Doc/MethodDoc.js~MethodDoc.html">MethodDoc</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Util/NPMUtil.js~NPMUtil.html">NPMUtil</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Util/NamingUtil.js~NamingUtil.html">NamingUtil</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Parser/ParamParser.js~ParamParser.html">ParamParser</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Util/PathResolver.js~PathResolver.html">PathResolver</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Publisher/Builder/SearchIndexBuilder.js~SearchIndexBuilder.html">SearchIndexBuilder</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Publisher/Builder/SingleDocBuilder.js~SingleDocBuilder.html">SingleDocBuilder</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Publisher/Builder/SourceDocBuilder.js~SourceDocBuilder.html">SourceDocBuilder</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Publisher/Builder/StaticFileBuilder.js~StaticFileBuilder.html">StaticFileBuilder</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Doc/TestDoc.js~TestDoc.html">TestDoc</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Publisher/Builder/TestDocBuilder.js~TestDocBuilder.html">TestDocBuilder</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Factory/TestDocFactory.js~TestDocFactory.html">TestDocFactory</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Doc/TestFileDoc.js~TestFileDoc.html">TestFileDoc</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Publisher/Builder/TestFileDocBuilder.js~TestFileDocBuilder.html">TestFileDocBuilder</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Doc/TypedefDoc.js~TypedefDoc.html">TypedefDoc</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Doc/VariableDoc.js~VariableDoc.html">VariableDoc</a></span></li>
</ul>
</div>



<div data-ice="functionWrap">
  <h2><a href="function/">Function</a></h2>
  <ul>
    
  <li data-ice="functionDoc"><span><a href="function/index.html#static-function-dateForUTC">dateForUTC</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-markdown">markdown</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-parseExample">parseExample</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-publish">publish</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-shorten">shorten</a></span></li>
</ul>
</div>

<div data-ice="variableWrap">
  <h2><a href="variable/">Variable</a></h2>
  <ul>
    
  <li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-invalidCodeLogger">invalidCodeLogger</a></span></li>
</ul>
</div>

<div data-ice="typedefWrap">
  <h2><a href="typedef/">Typedef</a></h2>
  <ul>
    
  <li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-AST">AST</a></span></li>
<li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-ASTNode">ASTNode</a></span></li>
<li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-CoverageObject">CoverageObject</a></span></li>
<li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-DocObject">DocObject</a></span></li>
<li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-DocTypedef">DocTypedef</a></span></li>
<li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-ESDocCLIArgv">ESDocCLIArgv</a></span></li>
<li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-ESDocConfig">ESDocConfig</a></span></li>
<li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-IceCap">IceCap</a></span></li>
<li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-IceCapInstanceTypedef">IceCapInstanceTypedef</a></span></li>
<li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-NPMPackageObject">NPMPackageObject</a></span></li>
<li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-PackageTypedef">PackageTypedef</a></span></li>
<li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-ParsedParam">ParsedParam</a></span></li>
<li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-Taffy">Taffy</a></span></li>
<li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-TaffyCursor">TaffyCursor</a></span></li>
<li data-ice="typedefDoc"><span><a href="typedef/index.html#static-typedef-Tag">Tag</a></span></li>
</ul>
</div>


</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/Publisher/Builder/ClassDocBuilder.js</h1>
<pre class="source-code line-number"><code class="prettyprint linenums" data-ice="content">import IceCap from &apos;ice-cap&apos;;
import DocBuilder from &apos;./DocBuilder.js&apos;;
import {parseExample} from &apos;./util.js&apos;;

/**
 * Class Output Builder class.
 */
export default class ClassDocBuilder extends DocBuilder {
  /**
   * execute building output.
   * @param {function(html: string, filePath: string)} callback - is called each class.
   */
  exec(callback) {
    let ice = this._buildLayoutDoc();
    ice.autoDrop = false;
    let docs = this._find({kind: [&apos;class&apos;]});
    for (let doc of docs) {
      let fileName = this._getOutputFileName(doc);
      let baseUrl = this._getBaseUrl(fileName);
      let title = this._getTitle(doc);
      ice.load(&apos;content&apos;, this._buildClassDoc(doc), IceCap.MODE_WRITE);
      ice.attr(&apos;baseUrl&apos;, &apos;href&apos;, baseUrl, IceCap.MODE_WRITE);
      ice.text(&apos;title&apos;, title, IceCap.MODE_WRITE);
      callback(ice.html, fileName);
    }
  }

  /**
   * build class output.
   * @param {DocObject} doc - class doc object.
   * @returns {IceCap} built output.
   * @private
   */
  _buildClassDoc(doc) {
    let expressionExtends = this._buildExpressionExtendsHTML(doc);
    let mixinClasses = this._buildMixinClassesHTML(doc);
    let extendsChain = this._buildExtendsChainHTML(doc);
    let directSubclass = this._buildDirectSubclassHTML(doc);
    let indirectSubclass = this._buildIndirectSubclassHTML(doc);
    let instanceDocs = this._find({kind: &apos;variable&apos;}).filter((v)=&gt; {
      return v.type &amp;&amp; v.type.types.includes(doc.longname);
    });

    let ice = new IceCap(this._readTemplate(&apos;class.html&apos;));

    // header
    if (doc.export &amp;&amp; doc.importPath &amp;&amp; doc.importStyle) {
      let link = this._buildFileDocLinkHTML(doc, doc.importPath);
      ice.into(&apos;importPath&apos;, `import ${doc.importStyle} from &apos;${link}&apos;`, (code, ice)=&gt;{
        ice.load(&apos;importPathCode&apos;, code);
      });
    }
    ice.text(&apos;access&apos;, doc.access);
    ice.text(&apos;kind&apos;, doc.interface ? &apos;interface&apos; : &apos;class&apos;);
    ice.load(&apos;source&apos;, this._buildFileDocLinkHTML(doc, &apos;source&apos;), &apos;append&apos;);
    ice.text(&apos;since&apos;, doc.since, &apos;append&apos;);
    ice.text(&apos;version&apos;, doc.version, &apos;append&apos;);
    ice.load(&apos;variation&apos;, this._buildVariationHTML(doc), &apos;append&apos;);

    ice.into(&apos;expressionExtends&apos;, expressionExtends, (expressionExtends, ice)=&gt; ice.load(&apos;expressionExtendsCode&apos;, expressionExtends));
    ice.load(&apos;mixinExtends&apos;, mixinClasses, &apos;append&apos;);
    ice.load(&apos;extendsChain&apos;, extendsChain, &apos;append&apos;);
    ice.load(&apos;directSubclass&apos;, directSubclass, &apos;append&apos;);
    ice.load(&apos;indirectSubclass&apos;, indirectSubclass, &apos;append&apos;);
    ice.load(&apos;implements&apos;, this._buildDocsLinkHTML(doc.implements, null, false, &apos;, &apos;), &apos;append&apos;);
    ice.load(&apos;indirectImplements&apos;, this._buildDocsLinkHTML(doc._custom_indirect_implements, null, false, &apos;, &apos;), &apos;append&apos;);
    ice.load(&apos;directImplemented&apos;, this._buildDocsLinkHTML(doc._custom_direct_implemented, null, false, &apos;, &apos;), &apos;append&apos;);
    ice.load(&apos;indirectImplemented&apos;, this._buildDocsLinkHTML(doc._custom_indirect_implemented, null, false, &apos;, &apos;), &apos;append&apos;);

    // self
    ice.text(&apos;name&apos;, doc.name);
    ice.load(&apos;description&apos;, doc.description);
    ice.load(&apos;deprecated&apos;, this._buildDeprecatedHTML(doc));
    ice.load(&apos;experimental&apos;, this._buildExperimentalHTML(doc));
    ice.load(&apos;see&apos;, this._buildDocsLinkHTML(doc.see), &apos;append&apos;);
    ice.load(&apos;todo&apos;, this._buildDocsLinkHTML(doc.todo), &apos;append&apos;);

    ice.into(&apos;instanceDocs&apos;, instanceDocs, (instanceDocs, ice)=&gt;{
      ice.loop(&apos;instanceDoc&apos;, instanceDocs, (i, instanceDoc, ice)=&gt;{
        ice.load(&apos;instanceDoc&apos;, this._buildDocLinkHTML(instanceDoc.longname));
      });
    });

    ice.into(&apos;exampleDocs&apos;, doc.examples, (examples, ice)=&gt;{
      ice.loop(&apos;exampleDoc&apos;, examples, (i, example, ice)=&gt;{
        let parsed = parseExample(example);
        ice.text(&apos;exampleCode&apos;, parsed.body);
        ice.text(&apos;exampleCaption&apos;, parsed.caption);
      });
    });

    ice.into(&apos;tests&apos;, doc._custom_tests, (tests, ice)=&gt;{
      ice.loop(&apos;test&apos;, tests, (i, test, ice)=&gt;{
        let testDoc = this._find({longname: test})[0];
        ice.load(&apos;test&apos;, this._buildFileDocLinkHTML(testDoc, testDoc.testFullDescription));
      });
    });

    // summary
    ice.load(&apos;staticMemberSummary&apos;, this._buildSummaryHTML(doc, &apos;member&apos;, &apos;Members&apos;, true));
    ice.load(&apos;staticMethodSummary&apos;, this._buildSummaryHTML(doc, &apos;method&apos;, &apos;Methods&apos;, true));
    ice.load(&apos;constructorSummary&apos;, this._buildSummaryHTML(doc, &apos;constructor&apos;, &apos;Constructor&apos;, false));
    ice.load(&apos;memberSummary&apos;, this._buildSummaryHTML(doc, &apos;member&apos;, &apos;Members&apos;, false));
    ice.load(&apos;methodSummary&apos;, this._buildSummaryHTML(doc, &apos;method&apos;, &apos;Methods&apos;, false));

    ice.load(&apos;inheritedSummary&apos;, this._buildInheritedSummaryHTML(doc), &apos;append&apos;);

    // detail
    ice.load(&apos;staticMemberDetails&apos;, this._buildDetailHTML(doc, &apos;member&apos;, &apos;Members&apos;, true));
    ice.load(&apos;staticMethodDetails&apos;, this._buildDetailHTML(doc, &apos;method&apos;, &apos;Methods&apos;, true));
    ice.load(&apos;constructorDetails&apos;, this._buildDetailHTML(doc, &apos;constructor&apos;, &apos;Constructors&apos;, false));
    ice.load(&apos;memberDetails&apos;, this._buildDetailHTML(doc, &apos;member&apos;, &apos;Members&apos;, false));
    ice.load(&apos;methodDetails&apos;, this._buildDetailHTML(doc, &apos;method&apos;, &apos;Methods&apos;, false));

    return ice;
  }

  /**
   * build variation of doc.
   * @param {DocObject} doc - target doc object.
   * @returns {string} variation links html.
   * @private
   * @experimental
   */
  _buildVariationHTML(doc) {
    var variationDocs = this._find({memberof: doc.memberof, name: doc.name});
    var html = [];
    for (var variationDoc of variationDocs) {
      if (variationDoc.variation === doc.variation) continue;

      html.push(this._buildDocLinkHTML(variationDoc.longname, `(${variationDoc.variation || 1})`));
    }

    return html.join(&apos;, &apos;);
  }

  /**
   * build mixin extends html.
   * @param {DocObject} doc - target class doc.
   * @return {string} mixin extends html.
   */
  _buildMixinClassesHTML(doc) {
    if (!doc.extends) return &apos;&apos;;
    if (doc.extends.length &lt;= 1) return &apos;&apos;;

    let links = [];
    for (var longname of doc.extends) {
      links.push(this._buildDocLinkHTML(longname));
    }

    return `&lt;div&gt;${links.join(&apos;, &apos;)}&lt;/div&gt;`;
  }

  /**
   * build expression extends html.
   * @param {DocObject} doc - target class doc.
   * @return {string} expression extends html.
   */
  _buildExpressionExtendsHTML(doc) {
    if (!doc.expressionExtends) return &apos;&apos;;

    let html = doc.expressionExtends.replace(/[A-Z_$][a-zA-Z0-9_$]*/g, (v)=&gt;{
      return this._buildDocLinkHTML(v);
    });

    return `class ${doc.name} extends ${html}`;
  }

  /**
   * build class ancestor extends chain.
   * @param {DocObject} doc - target class doc.
   * @returns {string} extends chain links html.
   * @private
   */
  _buildExtendsChainHTML(doc) {
    if (!doc._custom_extends_chains) return &apos;&apos;;
    if (doc.extends.length &gt; 1) return &apos;&apos;;

    var links = [];
    for (var longname of doc._custom_extends_chains) {
      links.push(this._buildDocLinkHTML(longname));
    }

    links.push(doc.name);

    return `&lt;div&gt;${links.join(&apos; &#x2192; &apos;)}&lt;/div&gt;`;
  }

  /**
   * build in-direct subclass list.
   * @param {DocObject} doc - target class doc.
   * @returns {string} html of in-direct subclass links.
   * @private
   */
  _buildIndirectSubclassHTML(doc) {
    if (!doc._custom_indirect_subclasses) return &apos;&apos;;

    var links = [];
    for (var longname of doc._custom_indirect_subclasses) {
      links.push(this._buildDocLinkHTML(longname));
    }

    return `&lt;div&gt;${links.join(&apos;, &apos;)}&lt;/div&gt;`;
  }

  /**
   * build direct subclass list.
   * @param {DocObject} doc - target class doc.
   * @returns {string} html of direct subclass links.
   * @private
   */
  _buildDirectSubclassHTML(doc) {
    if (!doc._custom_direct_subclasses) return &apos;&apos;;

    var links = [];
    for (var longname of doc._custom_direct_subclasses) {
      links.push(this._buildDocLinkHTML(longname));
    }

    return `&lt;div&gt;${links.join(&apos;, &apos;)}&lt;/div&gt;`;
  }

  /**
   * build inherited method/member summary.
   * @param {DocObject} doc - target class doc.
   * @returns {string} html of inherited method/member from ancestor classes.
   * @private
   */
  _buildInheritedSummaryHTML(doc) {
    if ([&apos;class&apos;, &apos;interface&apos;].indexOf(doc.kind) === -1) return &apos;&apos;;

    let longnames = [
      ...doc._custom_extends_chains || []
      //...doc.implements || [],
      //...doc._custom_indirect_implements || [],
    ];

    let html = [];
    for (let longname of longnames) {
      let superDoc = this._find({longname})[0];

      if (!superDoc) continue;

      let targetDocs = this._find({memberof: longname, kind: [&apos;member&apos;, &apos;method&apos;, &apos;get&apos;, &apos;set&apos;]});

      targetDocs.sort((a, b)=&gt;{
        if (a.static !== b.static) return -(a.static - b.static);

        let order = {get: 0, set: 0, member: 1, method: 2};
        if (order[a.kind] !== order[b.kind]) {
          return order[a.kind] - order[b.kind];
        }

        order = {public: 0, protected: 1, private: 2};
        if (a.access != b.access) return order[a.access] - order[b.access];

        if (a.name !== b.name) return a.name &lt; b.name ? -1 : 1;

        order = {get: 0, set: 1, member: 2};
        return order[a.kind] - order[b.kind];
      });

      let title = `&lt;span class=&quot;toggle closed&quot;&gt;&lt;/span&gt; From ${superDoc.kind} ${this._buildDocLinkHTML(longname, superDoc.name)}`;
      let result = this._buildSummaryDoc(targetDocs, &apos;----------&apos;, false, superDoc.kind);
      if (result) {
        result.load(&apos;title&apos;, title, IceCap.MODE_WRITE);
        html.push(result.html);
      }
    }

    return html.join(&apos;\n&apos;);
  }
}
</code></pre>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.1.4)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
