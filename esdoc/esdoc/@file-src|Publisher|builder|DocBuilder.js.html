<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
</head>
<body class="layout-container">

<nav class="navigation" data-ice="nav"><h1><a href="./">HOME</a> | <a href="@index.html">INDEX</a></h1>

<div data-ice="classWrap">
  <h2>Class</h2>
  <ul>
    
  <li data-ice="classDoc"><span><a href="%40class-src%7CUtil%7CASTUtil.js~ASTUtil.html">ASTUtil</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CDoc%7CAbstractDoc.js~AbstractDoc.html">AbstractDoc</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CDoc%7CAssignmentDoc.js~AssignmentDoc.html">AssignmentDoc</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CDoc%7CClassDoc.js~ClassDoc.html">ClassDoc</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CPublisher%7Cbuilder%7CClassDocBuilder.js~ClassDocBuilder.html">ClassDocBuilder</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CParser%7CCommentParser.js~CommentParser.html">CommentParser</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CPublisher%7Cbuilder%7CDocBuilder.js~DocBuilder.html">DocBuilder</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CFactory%7CDocFactory.js~DocFactory.html">DocFactory</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CPublisher%7Cbuilder%7CDocResolver.js~DocResolver.html">DocResolver</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CESDoc.js~ESDoc.html">ESDoc</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CESDocCLI.js~ESDocCLI.html">ESDocCLI</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CParser%7CESParser.js~ESParser.html">ESParser</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CDoc%7CExternalDoc.js~ExternalDoc.html">ExternalDoc</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CDoc%7CFileDoc.js~FileDoc.html">FileDoc</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CPublisher%7Cbuilder%7CFileDocBuilder.js~FileDocBuilder.html">FileDocBuilder</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CDoc%7CFunctionDoc.js~FunctionDoc.html">FunctionDoc</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CPublisher%7Cbuilder%7CIndexDocBuilder.js~IndexDocBuilder.html">IndexDocBuilder</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CDoc%7CMemberDoc.js~MemberDoc.html">MemberDoc</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CDoc%7CMethodDoc.js~MethodDoc.html">MethodDoc</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CParser%7CParamParser.js~ParamParser.html">ParamParser</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CUtil%7CPathResolver.js~PathResolver.html">PathResolver</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CPublisher%7Cbuilder%7CReadmeDocBuilder.js~ReadmeDocBuilder.html">ReadmeDocBuilder</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CPublisher%7Cbuilder%7CSearchIndexBuilder.js~SearchIndexBuilder.html">SearchIndexBuilder</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CPublisher%7Cbuilder%7CSingleDocBuilder.js~SingleDocBuilder.html">SingleDocBuilder</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CPublisher%7Cbuilder%7CStaticFileBuilder.js~StaticFileBuilder.html">StaticFileBuilder</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CDoc%7CTypedefDoc.js~TypedefDoc.html">TypedefDoc</a></span></li>
<li data-ice="classDoc"><span><a href="%40class-src%7CDoc%7CVariableDoc.js~VariableDoc.html">VariableDoc</a></span></li>
</ul>
</div>







<div data-ice="typedefWrap">
  <h2><a href="@typedef.html">Typedef</a></h2>
  <ul>
    
  <li data-ice="typedefDoc"><span><a href="%40typedef.html#static-typedef-DocObject">DocObject</a></span></li>
<li data-ice="typedefDoc"><span><a href="%40typedef.html#static-typedef-DocTypedef">DocTypedef</a></span></li>
<li data-ice="typedefDoc"><span><a href="%40typedef.html#static-typedef-ESDocConfig">ESDocConfig</a></span></li>
<li data-ice="typedefDoc"><span><a href="%40typedef.html#static-typedef-IceCapInstanceTypedef">IceCapInstanceTypedef</a></span></li>
<li data-ice="typedefDoc"><span><a href="%40typedef.html#static-typedef-PackageTypedef">PackageTypedef</a></span></li>
<li data-ice="typedefDoc"><span><a href="%40typedef.html#static-typedef-TaffyCursor">TaffyCursor</a></span></li>
<li data-ice="typedefDoc"><span><a href="%40typedef.html#static-typedef-Tag">Tag</a></span></li>
</ul>
</div>

<div data-ice="fileWrap">
  <h2>File</h2>
  <ul>
    
  <li data-ice="fileDoc"><span><a href="%40file-src%7CDoc%7CAbstractDoc.js.html#lineNumber1">src/Doc/AbstractDoc.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CDoc%7CAssignmentDoc.js.html#lineNumber1">src/Doc/AssignmentDoc.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CDoc%7CClassDoc.js.html#lineNumber1">src/Doc/ClassDoc.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CDoc%7CExternalDoc.js.html#lineNumber1">src/Doc/ExternalDoc.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CDoc%7CFileDoc.js.html#lineNumber1">src/Doc/FileDoc.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CDoc%7CFunctionDoc.js.html#lineNumber1">src/Doc/FunctionDoc.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CDoc%7CMemberDoc.js.html#lineNumber1">src/Doc/MemberDoc.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CDoc%7CMethodDoc.js.html#lineNumber1">src/Doc/MethodDoc.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CDoc%7CTypedefDoc.js.html#lineNumber1">src/Doc/TypedefDoc.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CDoc%7CVariableDoc.js.html#lineNumber1">src/Doc/VariableDoc.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CESDoc.js.html#lineNumber1">src/ESDoc.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CESDocCLI.js.html#lineNumber2">src/ESDocCLI.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CFactory%7CDocFactory.js.html#lineNumber1">src/Factory/DocFactory.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CParser%7CCommentParser.js.html#lineNumber1">src/Parser/CommentParser.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CParser%7CESParser.js.html#lineNumber1">src/Parser/ESParser.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CParser%7CParamParser.js.html#lineNumber1">src/Parser/ParamParser.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CPublisher%7Cbuilder%7CClassDocBuilder.js.html#lineNumber1">src/Publisher/builder/ClassDocBuilder.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CPublisher%7Cbuilder%7CDocBuilder.js.html#lineNumber1">src/Publisher/builder/DocBuilder.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CPublisher%7Cbuilder%7CDocResolver.js.html#lineNumber1">src/Publisher/builder/DocResolver.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CPublisher%7Cbuilder%7CFileDocBuilder.js.html#lineNumber1">src/Publisher/builder/FileDocBuilder.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CPublisher%7Cbuilder%7CIndexDocBuilder.js.html#lineNumber1">src/Publisher/builder/IndexDocBuilder.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CPublisher%7Cbuilder%7CReadmeDocBuilder.js.html#lineNumber1">src/Publisher/builder/ReadmeDocBuilder.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CPublisher%7Cbuilder%7CSearchIndexBuilder.js.html#lineNumber1">src/Publisher/builder/SearchIndexBuilder.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CPublisher%7Cbuilder%7CSingleDocBuilder.js.html#lineNumber1">src/Publisher/builder/SingleDocBuilder.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CPublisher%7Cbuilder%7CStaticFileBuilder.js.html#lineNumber1">src/Publisher/builder/StaticFileBuilder.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CPublisher%7Cbuilder%7Cutil.js.html#lineNumber1">src/Publisher/builder/util.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CPublisher%7Cpublish.js.html#lineNumber1">src/Publisher/publish.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CTypedef%7Ctypedef.js.html#lineNumber51">src/Typedef/typedef.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CUtil%7CASTUtil.js.html#lineNumber1">src/Util/ASTUtil.js</a></span></li>
<li data-ice="fileDoc"><span><a href="%40file-src%7CUtil%7CPathResolver.js.html#lineNumber1">src/Util/PathResolver.js</a></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/Publisher/builder/DocBuilder.js</h1>
<pre class="source-code line-number"><code class="prettyprint linenums" data-ice="content">import fs from &apos;fs&apos;;
import path from &apos;path&apos;;
import escape from &apos;escape-html&apos;;
import IceCap from &apos;ice-cap&apos;;
import {shorten} from &apos;./util.js&apos;;
import DocResolver from &apos;./DocResolver.js&apos;;

export default class DocBuilder {
  constructor(data, config) {
    this._data = data;
    this._config = config;
    new DocResolver(this).resolve();
  }

  /**
   * @abstract
   * @param callback
   */
  exec(callback) {
  }

  _find(...cond) {
    return this._orderedFind(null, ...cond);
  }

  _findByName(name, kind = null) {
    let docs;

    if (kind) {
      docs = this._orderedFind(null, {longname: name, kind: kind});
    } else {
      docs = this._orderedFind(null, {longname: name});
    }
    if (docs.length) return docs;

    if (kind) {
      docs = this._orderedFind(null, {name: name, kind: kind});
    } else {
      docs = this._orderedFind(null, {name: name});
    }
    if (docs.length) return docs;

    if (kind) {
      docs = this._orderedFind(null, {longname: {right: name}, kind: kind});
    } else {
      docs = this._orderedFind(null, {longname: {right: name}});
    }
    if (docs.length) return docs;

    return [];
  }

  _orderedFind(order, ...cond) {
    let data = this._data(...cond);

    if (order) {
      return data.order(order + &apos;, name asec&apos;).map(v =&gt; v);
    } else {
      return data.order(&apos;name asec&apos;).map(v =&gt; v);
    }
  }

  _readTemplate(fileName) {
    let filePath = path.resolve(__dirname, `./template/${fileName}`);
    return fs.readFileSync(filePath, {encoding: &apos;utf-8&apos;});
  }

  _getInfo() {
    let config = this._config;
    let packageObj = {};
    if (config.package) {
      let packagePath = config.package;
      let json = fs.readFileSync(packagePath, {encoding: &apos;utf-8&apos;});
      packageObj = JSON.parse(json);
    }

    let indexInfo = {
      title: config.title || packageObj.name,
      desc: config.description || packageObj.description,
      version: config.version || packageObj.version,
      url: config.url || packageObj.repository ? packageObj.repository.url : &apos;&apos;
    };

    return indexInfo;
  }

  _buildLayoutDoc() {
    let info = this._getInfo();

    let ice = new IceCap(this._readTemplate(&apos;layout.html&apos;), {autoClose: false});

    ice.text(&apos;version&apos;, info.version);
    ice.text(&apos;url&apos;, info.url);
    ice.attr(&apos;url&apos;, &apos;href&apos;, info.url);

    // see StaticFileBuilder#exec
    ice.loop(&apos;userScript&apos;, this._config.scripts || [], (i, userScript, ice)=&gt;{
      let name = `user/script/${i}-${path.basename(userScript)}`;
      ice.attr(&apos;userScript&apos;, &apos;src&apos;, name);
    });

    ice.loop(&apos;userStyle&apos;, this._config.styles || [], (i, userStyle, ice)=&gt;{
      let name = `user/css/${i}-${path.basename(userStyle)}`;
      ice.attr(&apos;userStyle&apos;, &apos;href&apos;, name);
    });

    ice.load(&apos;nav&apos;, this._buildNavDoc());
    return ice;
  }

  _buildNavDoc() {
    let html = this._readTemplate(&apos;nav.html&apos;);
    let ice = new IceCap(html);

    // class
    let classDocs = this._find({kind: &apos;class&apos;, interface: false});
    ice.drop(&apos;classWrap&apos;, !classDocs.length);
    ice.loop(&apos;classDoc&apos;, classDocs, (i, classDoc, ice)=&gt;{
      ice.load(&apos;classDoc&apos;, this._buildDocLinkHTML(classDoc.longname));
    });

    // interface
    let interfaceDocs = this._find({kind: &apos;class&apos;, interface: true});
    ice.drop(&apos;interfaceWrap&apos;, !interfaceDocs.length);
    ice.loop(&apos;interfaceDoc&apos;, interfaceDocs, (i, interfaceDoc, ice)=&gt;{
      ice.load(&apos;interfaceDoc&apos;, this._buildDocLinkHTML(interfaceDoc.longname));
    });

    // function
    let functionDocs = this._find({kind: &apos;function&apos;});
    ice.drop(&apos;functionWrap&apos;, !functionDocs.length);
    ice.loop(&apos;functionDoc&apos;, functionDocs, (i, functionDoc, ice)=&gt;{
      ice.load(&apos;functionDoc&apos;, this._buildDocLinkHTML(functionDoc.longname));
    });

    // variable
    let variableDocs = this._find({kind: &apos;variable&apos;});
    ice.drop(&apos;variableWrap&apos;, !variableDocs.length);
    ice.loop(&apos;variableDoc&apos;, variableDocs, (i, variableDoc, ice)=&gt;{
      ice.load(&apos;variableDoc&apos;, this._buildDocLinkHTML(variableDoc.longname));
    });

    // typedef
    let typedefDocs = this._find({kind: &apos;typedef&apos;});
    ice.drop(&apos;typedefWrap&apos;, !typedefDocs.length);
    ice.loop(&apos;typedefDoc&apos;, typedefDocs, (i, typedefDoc, ice)=&gt;{
      ice.load(&apos;typedefDoc&apos;, this._buildDocLinkHTML(typedefDoc.longname));
    });

    // files
    let fileDocs = this._find({kind: &apos;file&apos;});
    ice.drop(&apos;fileWrap&apos;, !fileDocs.length);
    ice.loop(&apos;fileDoc&apos;, fileDocs, (i, fileDoc, ice)=&gt;{
      ice.load(&apos;fileDoc&apos;, this._buildFileDocLinkHTML(fileDoc));
    });

    return ice;
  }

  _findAccessDocs(doc, kind, isStatic = true) {
    let cond = {kind, static: isStatic};

    if (doc) cond.memberof = doc.longname;

    switch (kind) {
      case &apos;class&apos;:
        cond.interface = false;
        break;
      case &apos;interface&apos;:
        cond.kind = &apos;class&apos;;
        cond.interface = true;
        break;
      case &apos;member&apos;:
        cond.kind = [&apos;member&apos;, &apos;get&apos;, &apos;set&apos;];
        break;
    }

    let publicDocs = this._find(cond, {access: &apos;public&apos;});
    let protectedDocs = this._find(cond, {access: &apos;protected&apos;});
    let privateDocs = this._find(cond, {access: &apos;private&apos;});
    let accessDocs = [[&apos;Public&apos;, publicDocs], [&apos;Protected&apos;, protectedDocs], [&apos;Private&apos;, privateDocs]];

    return accessDocs;
  }

  _buildSummaryHTML(doc, kind, title, isStatic = true) {
    let accessDocs = this._findAccessDocs(doc, kind, isStatic);
    let html = &apos;&apos;;
    for (let accessDoc of accessDocs) {
      let docs = accessDoc[1];
      if (!docs.length) continue;

      let prefix = &apos;&apos;;
      if (docs[0].static) prefix = &apos;Static &apos;;
      let _title = `${prefix}${accessDoc[0]} ${title}`;

      let result = this._buildSummaryDoc(docs, _title);
      if (result) {
        html += result.html;
      }
    }

    return html;
  }

  _buildSummaryDoc(docs, title, innerLink) {
    if (docs.length === 0) return;

    let ice = new IceCap(this._readTemplate(&apos;summary.html&apos;));

    ice.text(&apos;title&apos;, title);
    ice.loop(&apos;target&apos;, docs, (i, doc, ice)=&gt;{
      ice.text(&apos;generator&apos;, doc.generator ? &apos;*&apos; : &apos;&apos;);
      ice.load(&apos;name&apos;, this._buildDocLinkHTML(doc.longname, null, innerLink, doc.kind));
      ice.load(&apos;signature&apos;, this._buildSignatureHTML(doc));
      ice.load(&apos;description&apos;, shorten(doc));
      ice.text(&apos;abstract&apos;, doc.abstract ? &apos;abstract&apos; : &apos;&apos;);
      ice.text(&apos;access&apos;, doc.access);
      if ([&apos;get&apos;, &apos;set&apos;].includes(doc.kind)) {
        ice.text(&apos;kind&apos;, doc.kind);
      } else {
        ice.drop(&apos;kind&apos;);
      }

      if ([&apos;member&apos;, &apos;method&apos;, &apos;get&apos;, &apos;set&apos;].includes(doc.kind)) {
        ice.text(&apos;static&apos;, doc.static ? &apos;static&apos; : &apos;&apos;);
      } else {
        ice.drop(&apos;static&apos;);
      }

      ice.text(&apos;since&apos;, doc.since);
      ice.load(&apos;deprecated&apos;, this._buildDeprecatedHTML(doc));
      ice.load(&apos;experimental&apos;, this._buildExperimentalHTML(doc));
      ice.text(&apos;version&apos;, doc.version);
    });

    return ice;
  }

  _buildDetailHTML(doc, kind, title, isStatic = true) {
    let accessDocs = this._findAccessDocs(doc, kind, isStatic);
    let html = &apos;&apos;;
    for (let accessDoc of accessDocs) {
      let docs = accessDoc[1];
      if (!docs.length) continue;

      let prefix = &apos;&apos;;
      if (docs[0].static) prefix = &apos;Static &apos;;
      let _title = `${prefix}${accessDoc[0]} ${title}`;

      let result = this._buildDetailDocs(docs, _title);
      if (result) html += result.html;
    }

    return html;
  }

  _buildDetailDocs(docs, title) {
    let ice = new IceCap(this._readTemplate(&apos;details.html&apos;));

    ice.text(&apos;title&apos;, title);
    ice.drop(&apos;title&apos;, !docs.length);

    ice.loop(&apos;detail&apos;, docs, (i, doc, ice)=&gt;{
      let scope = doc.static ? &apos;static&apos; : &apos;instance&apos;;
      ice.attr(&apos;anchor&apos;, &apos;id&apos;, `${scope}-${doc.kind}-${doc.name}`);
      ice.text(&apos;generator&apos;, doc.generator ? &apos;*&apos; : &apos;&apos;);
      ice.text(&apos;name&apos;, doc.name);
      ice.load(&apos;signature&apos;, this._buildSignatureHTML(doc));
      ice.load(&apos;description&apos;, doc.description);
      ice.text(&apos;abstract&apos;, doc.abstract ? &apos;abstract&apos; : &apos;&apos;);
      ice.text(&apos;access&apos;, doc.access);
      if ([&apos;get&apos;, &apos;set&apos;].includes(doc.kind)) {
        ice.text(&apos;kind&apos;, doc.kind);
      } else {
        ice.drop(&apos;kind&apos;);
      }
      if (doc.export &amp;&amp; doc.importPath &amp;&amp; doc.importStyle) {
        let link = this._buildFileDocLinkHTML(doc, doc.importPath);
        ice.into(&apos;importPath&apos;, `import ${doc.importStyle} from &apos;${link}&apos;`, (code, ice)=&gt;{
          ice.load(&apos;importPathCode&apos;, code);
        });
      } else {
        ice.drop(&apos;importPath&apos;);
      }

      if ([&apos;member&apos;, &apos;method&apos;, &apos;get&apos;, &apos;set&apos;].includes(doc.kind)) {
        ice.text(&apos;static&apos;, doc.static ? &apos;static&apos; : &apos;&apos;);
      } else {
        ice.drop(&apos;static&apos;);
      }

      ice.load(&apos;source&apos;, this._buildFileDocLinkHTML(doc, &apos;source&apos;));
      ice.text(&apos;since&apos;, doc.since, &apos;append&apos;);
      ice.load(&apos;deprecated&apos;, this._buildDeprecatedHTML(doc));
      ice.load(&apos;experimental&apos;, this._buildExperimentalHTML(doc));
      ice.text(&apos;version&apos;, doc.version, &apos;append&apos;);
      ice.load(&apos;see&apos;, this._buildDocsLinkHTML(doc.see), &apos;append&apos;);
      ice.load(&apos;todo&apos;, this._buildDocsLinkHTML(doc.todo), &apos;append&apos;);
      ice.load(&apos;override&apos;, this._buildOverrideMethod(doc));

      if ([&apos;method&apos;, &apos;constructor&apos;, &apos;function&apos;].indexOf(doc.kind) !== -1) {
        ice.load(&apos;properties&apos;, this._buildProperties(doc.params, &apos;Params:&apos;));
      } else {
        ice.load(&apos;properties&apos;, this._buildProperties(doc.properties, &apos;Properties:&apos;));
      }

      // return
      if (doc.return) {
        ice.load(&apos;returnDescription&apos;, doc.return.description);
        let typeNames = [];
        for (let typeName of doc.return.types) {
          typeNames.push(this._buildDocLinkHTML(typeName));
        }
        if (typeof doc.return.nullable === &apos;boolean&apos;) {
          let nullable = doc.return.nullable;
          ice.load(&apos;returnType&apos;, typeNames.join(&apos; | &apos;) + ` (nullable: ${nullable})`);
        } else {
          ice.load(&apos;returnType&apos;, typeNames.join(&apos; | &apos;));
        }

        ice.load(&apos;returnProperties&apos;, this._buildProperties(doc.properties, &apos;Return Properties:&apos;));
      } else {
        ice.drop(&apos;returnParams&apos;);
      }

      // throws
      if (doc.throws) {
        ice.loop(&apos;throw&apos;, doc.throws, (i, exceptionDoc, ice)=&gt;{
          ice.load(&apos;throwName&apos;, this._buildDocLinkHTML(exceptionDoc.types[0]));
          ice.load(&apos;throwDesc&apos;, exceptionDoc.description);
        });
      } else {
        ice.drop(&apos;throwWrap&apos;);
      }

      // fires
      if (doc.emits) {
        ice.loop(&apos;emit&apos;, doc.emits, (i, emitDoc, ice)=&gt;{
          ice.load(&apos;emitName&apos;, this._buildDocLinkHTML(emitDoc.types[0]));
          ice.load(&apos;emitDesc&apos;, emitDoc.description);
        });
      } else {
        ice.drop(&apos;emitWrap&apos;);
      }

      // listens
      if (doc.listens) {
        ice.loop(&apos;listen&apos;, doc.listens, (i, listenDoc, ice)=&gt;{
          ice.load(&apos;listenName&apos;, this._buildDocLinkHTML(listenDoc.types[0]));
          ice.load(&apos;listenDesc&apos;, listenDoc.description);
        });
      } else {
        ice.drop(&apos;listenWrap&apos;);
      }

      // example
      ice.into(&apos;example&apos;, doc.examples, (examples, ice)=&gt;{
        ice.loop(&apos;exampleDoc&apos;, examples, (i, exampleDoc, ice)=&gt;{
          ice.text(&apos;exampleCode&apos;, exampleDoc);
        });
      });
    });

    return ice;
  }

  _getURL(doc) {
    let inner = false;
    if ([&apos;variable&apos;, &apos;function&apos;, &apos;member&apos;, &apos;typedef&apos;, &apos;method&apos;, &apos;constructor&apos;, &apos;get&apos;, &apos;set&apos;].includes(doc.kind)) {
      inner = true
    }

    if (inner) {
      let scope = doc.static ? &apos;static&apos; : &apos;instance&apos;;
      let fileName = this._getOutputFileName(doc);
      return `${encodeURIComponent(fileName)}#${scope}-${doc.kind}-${doc.name}`;
    } else {
      let fileName = this._getOutputFileName(doc);
      return encodeURIComponent(fileName);
    }
  }

  _getOutputFileName(doc) {
    let name;
    switch (doc.kind) {
      case &apos;variable&apos;:
        return &apos;@variable.html&apos;;
      case &apos;function&apos;:
        return &apos;@function.html&apos;;
      case &apos;member&apos;: // fall
      case &apos;method&apos;: // fall
      case &apos;constructor&apos;: // fall
      case &apos;set&apos;: // fall
      case &apos;get&apos;: // fal
        let parentDoc = this._find({longname: doc.memberof})[0];
        return this._getOutputFileName(parentDoc);
      case &apos;external&apos;:
        return &apos;@external.html&apos;;
      case &apos;typedef&apos;:
        return &apos;@typedef.html&apos;;
      case &apos;class&apos;:
        name = doc.longname.replace(/\//g, &apos;|&apos;);
        return `@class-${name}.html`;
      case &apos;file&apos;:
        name = doc.longname.replace(/\//g, &apos;|&apos;);
        return `@file-${name}.html`;
      default:
        throw new Error(&apos;DocBuilder: can not resolve file name.&apos;);
    }
  }

  _buildFileDocLinkHTML(doc, text = null) {
    if (!doc) return;

    let fileDoc;
    if (doc.kind === &apos;file&apos;) {
      fileDoc = doc;
    } else {
      let filePath = doc.longname.split(&apos;~&apos;)[0];
      fileDoc = this._find({kind: &apos;file&apos;, longname: filePath})[0];
    }

    if (!fileDoc) return;

    if (!text) text = fileDoc.name;
    return `<span><a href="${this._getURL(fileDoc)}#lineNumber${doc.lineNumber}">${text}</a></span>`;
  }

  _buildDocLinkHTML(longname, text = null, inner = false, kind = null) {
    if (!longname) return &apos;&apos;;

    if (typeof longname !== &apos;string&apos;) throw new Error(JSON.stringify(longname));

    // TODO: support nested Array
    // Array.<foo>
    let isArray = false;
    let matched = longname.match(/^(.*?)\[\]$/) || longname.match(/^Array\.<(.*?)>$/);
    if (matched) {
      longname = matched[1];
      isArray = true;
    }

    let doc = this._findByName(longname, kind)[0];

    if (!doc) {
      // if longname is HTML tag, not escape.
      let arraySuffix = isArray ? &apos;[]&apos; : &apos;&apos;;
      if (longname.indexOf(&apos;<') =="=" 0)="" {="" return="" `<span="">${longname}${arraySuffix}`;
      } else {
        return `<span>${escape(text || longname)}${arraySuffix}</span>`;
      }
    }

    if (doc.kind === &apos;external&apos;) {
      //text = doc.longname.replace(/^external:\s*/, &apos;&apos;);
      text = doc.name;
      let arraySuffix = isArray ? &apos;[]&apos; : &apos;&apos;;
      return `<span><a href="${doc.externalLink}">${text}</a>${arraySuffix}</span>`;
    } else {
      text = escape(text || doc.name);
      let url = this._getURL(doc, inner);
      let arraySuffix = isArray ? &apos;[]&apos; : &apos;&apos;;
      if (url) {
        return `<span><a href="${url}">${text}</a>${arraySuffix}</span>`;
      } else {
        return `<span>${text}${arraySuffix}</span>`;
      }
    }
  }

  _buildDocsLinkHTML(longnames, text = null, inner = false, separator = &apos;\n&apos;) {
    if (!longnames) return;
    if (!longnames.length) return;

    let links = [];
    for (var longname of longnames) {
      if (!longname) continue;
      let link = this._buildDocLinkHTML(longname, text, inner);
      links.push(`<li>${link}</li>`);
    }

    if (!links.length) return;

    return `<ul>${links.join(separator)}</ul>`;
  }

  _buildSignatureHTML(doc) {
    // call signature
    let callSignatures = [];
    if (doc.params) {
      for (let param of doc.params) {
        let paramName = param.name;
        if (paramName.indexOf(&apos;.&apos;) !== -1) continue;

        let types = [];
        for (let typeName of param.types) {
          types.push(this._buildDocLinkHTML(typeName));
        }

        callSignatures.push(`${paramName}: ${types.join(&apos; | &apos;)}`);
      }
    }

    // return signature
    let returnSignatures = [];
    if (doc.return) {
      for (let typeName of doc.return.types) {
        returnSignatures.push(this._buildDocLinkHTML(typeName));
      }
    }

    // type signature
    let typeSignatures = [];
    if (doc.type) {
      for (let typeName of doc.type.types) {
        typeSignatures.push(this._buildDocLinkHTML(typeName));
      }
    }

    // callback is not need type. because type is always function.
    if (doc.kind === &apos;function&apos;) {
      typeSignatures = [];
    }

    let html = &apos;&apos;;
    if (callSignatures.length) {
      html = `(${callSignatures.join(&apos;, &apos;)})`;
    } else if ([&apos;function&apos;, &apos;method&apos;].includes(doc.kind)) {
      html = &apos;()&apos;;
    }
    if (returnSignatures.length) html = `${html}: ${returnSignatures.join(&apos; | &apos;)}`;
    if (typeSignatures.length) html = `${html}: ${typeSignatures.join(&apos; | &apos;)}`;

    return html;
  }

  _buildProperties(properties = [], title = &apos;Properties:&apos;) {
    let ice = new IceCap(this._readTemplate(&apos;properties.html&apos;));

    ice.text(&apos;title&apos;, title);

    ice.loop(&apos;property&apos;, properties, (i, prop, ice)=&gt;{
      ice.autoDrop = false;
      ice.attr(&apos;property&apos;, &apos;data-depth&apos;, prop.name.split(&apos;.&apos;).length - 1);
      ice.text(&apos;name&apos;, prop.name);
      ice.attr(&apos;name&apos;, &apos;data-depth&apos;, prop.name.split(&apos;.&apos;).length - 1);
      ice.load(&apos;description&apos;, prop.description);

      let typeNames = [];
      for (var typeName of prop.types) {
        typeNames.push(this._buildDocLinkHTML(typeName));
      }
      ice.load(&apos;type&apos;, typeNames.join(&apos; | &apos;));

      // appendix
      let appendix = [];
      if (prop.optional) {
        appendix.push(&apos;<li>optional</li>&apos;);
      }
      if (&apos;defaultValue&apos; in prop) {
        appendix.push(`<li>default: ${prop.defaultValue}</li>`);
      }
      if (typeof prop.nullable === &apos;boolean&apos;) {
        appendix.push(`<li>nullable: ${prop.nullable}</li>`);
      }
      if (appendix.length) {
        ice.load(&apos;appendix&apos;, `<ul>${appendix.join(&apos;\n&apos;)}</ul>`);
      } else {
        ice.text(&apos;appendix&apos;, &apos;&apos;);
      }
    });

    if (!properties || properties.length === 0) {
      ice.drop(&apos;properties&apos;);
    }

    return ice;
  }

  _buildDeprecatedHTML(doc) {
    if (doc.deprecated) {
      let deprecated = [`this ${doc.kind} was deprecated.`];
      if (typeof doc.deprecated === &apos;string&apos;) deprecated.push(doc.deprecated);
      return deprecated.join(&apos; &apos;);
    } else {
      return &apos;&apos;;
    }
  }

  _buildExperimentalHTML(doc) {
    if (doc.experimental) {
      let experimental = [`this ${doc.kind} is experimental.`];
      if (typeof doc.experimental === &apos;string&apos;) experimental.push(doc.experimental);
      return experimental.join(&apos; &apos;);
    } else {
      return &apos;&apos;;
    }
  }

  _buildOverrideMethod(doc) {
    let parentDoc = this._findByName(doc.memberof)[0];
    if (!parentDoc) return;
    if (!parentDoc._custom_extends_chains) return;

    let chains = [...parentDoc._custom_extends_chains].reverse();
    for (let longname of chains) {
      let superClassDoc = this._findByName(longname)[0];
      if (!superClassDoc) continue;

      let superMethodDoc = this._find({name: doc.name, memberof: superClassDoc.longname})[0];
      if (!superMethodDoc) continue;

      return this._buildDocLinkHTML(superMethodDoc.longname, `${superClassDoc.name}#${superMethodDoc.name}`, true);
    }
  }

  //_buildAuthorHTML(doc, separator = &apos;\n&apos;) {
  //  if (!doc.author) return &apos;&apos;;
  //
  //  var html = [];
  //  for (var author of doc.author) {
  //    var matched = author.match(/(.*?) *<(.*?)>/);
  //    if (matched) {
  //      var name = matched[1];
  //      var link = matched[2];
  //      if (link.indexOf(&apos;http&apos;) === 0) {
  //        html.push(`<li><a href="${link}">${name}</a></li>`)
  //      } else {
  //        html.push(`<li><a href="mailto:${link}">${name}</a></li>`)
  //      }
  //    } else {
  //      html.push(`<li>${author}</li>`)
  //    }
  //  }
  //
  //  return `<ul>${html.join(separator)}</ul>`;
  //}
}
</(.*?)></')></(.*?)></foo></code></pre>
</div>

<footer class="footer">
  <span class="version" data-ice="version">version: 0.0.1</span>
  <span class="url"><a data-ice="url" href="https://github.com/h13i32maru/esdoc">https://github.com/h13i32maru/esdoc</a></span>
  Generated by <a href="https://esdoc.org">ESDoc</a>
</footer>

<div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
  <ul class="search-result"></ul>
</div>
<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
</body>
</html>
